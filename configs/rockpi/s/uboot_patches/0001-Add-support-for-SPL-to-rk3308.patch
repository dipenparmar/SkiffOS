From 2361877ee4ea7cd8ca8be6d71ba6a7b49284083c Mon Sep 17 00:00:00 2001
From: Christian Stewart <christian@paral.in>
Date: Thu, 5 Sep 2019 16:47:48 -0700
Subject: [PATCH] Add support for SPL to rk3308

Signed-off-by: Christian Stewart <christian@paral.in>
---
 arch/arm/mach-rockchip/Kconfig    |  8 ++++++++
 configs/rockpi-s-rk3308_defconfig | 34 +++++++++++++++++++++++++++++++
 2 files changed, 42 insertions(+)

diff --git a/arch/arm/mach-rockchip/Kconfig b/arch/arm/mach-rockchip/Kconfig
index c16ad23909..f6e20b8c87 100644
--- a/arch/arm/mach-rockchip/Kconfig
+++ b/arch/arm/mach-rockchip/Kconfig
@@ -215,6 +215,14 @@ config ROCKCHIP_RK3308
 	select DEBUG_UART_BOARD_INIT
 	select ARM_SMCCC
 	select GICV2
+	select SUPPORT_TPL
+	select SPL
+	select TPL
+	select TPL_NEEDS_SEPARATE_TEXT_BASE if TPL
+	select TPL_NEEDS_SEPARATE_STACK if TPL
+	imply SPL_SERIAL_SUPPORT
+	imply TPL_SERIAL_SUPPORT
+	imply SPL_SEPARATE_BSS
 	help
 	  The Rockchip RK3308 is a ARM-based Soc which embeded with quad
 	  Cortex-A35 and highly integrated audio interfaces.
diff --git a/configs/rockpi-s-rk3308_defconfig b/configs/rockpi-s-rk3308_defconfig
index b5c2dd93b4..649b5b7896 100644
--- a/configs/rockpi-s-rk3308_defconfig
+++ b/configs/rockpi-s-rk3308_defconfig
@@ -80,3 +80,37 @@ CONFIG_LZO=y
 CONFIG_ERRNO_STR=y
 CONFIG_OF_LIBFDT_OVERLAY=y
 # CONFIG_EFI_LOADER is not set
+
+CONFIG_SPL_FIT_SOURCE="board/rockchip/evb_rk3308/fit_spl_atf.its"
+CONFIG_TPL_TEXT_BASE=0x10081000
+CONFIG_TPL_STACK=0x10081fff
+# CONFIG_SPL_ROCKCHIP_BACK_TO_BROM is not set
+CONFIG_TPL_ROCKCHIP_BACK_TO_BROM=y
+CONFIG_ROCKCHIP_SPL_RESERVE_IRAM=0x0
+CONFIG_SPL_DRIVERS_MISC_SUPPORT=y
+CONFIG_SPL_STACK_R_ADDR=0x60600000
+CONFIG_TPL_SYS_MALLOC_F_LEN=0x0
+CONFIG_FIT=y
+CONFIG_FIT_VERBOSE=y
+CONFIG_SPL_LOAD_FIT=y
+CONFIG_SPL_FIT_GENERATOR="arch/arm/mach-rockchip/make_fit_optee.sh"
+# CONFIG_SPL_RAW_IMAGE_SUPPORT is not set
+# CONFIG_SPL_LEGACY_IMAGE_SUPPORT is not set
+CONFIG_SPL_STACK_R=y
+CONFIG_SPL_STACK_R_MALLOC_SIMPLE_LEN=0x2000
+CONFIG_SPL_OPTEE_SUPPORT=y
+CONFIG_SPL_OPTEE=y
+CONFIG_TPL_TINY_FRAMEWORK=y
+CONFIG_TPL_SERIAL_SUPPORT=y
+# CONFIG_SPL_DOS_PARTITION is not set
+# CONFIG_SPL_ISO_PARTITION is not set
+# CONFIG_SPL_EFI_PARTITION is not set
+CONFIG_SPL_PARTITION_UUIDS=y
+CONFIG_SPL_OF_CONTROL=y
+CONFIG_SPL_REGMAP=y
+CONFIG_SPL_SYSCON=y
+CONFIG_SPL_CLK=y
+CONFIG_SPL_PINCTRL=y
+CONFIG_SPL_RAM=y
+# CONFIG_TPL_DM_SERIAL is not set
+
-- 
2.23.0

